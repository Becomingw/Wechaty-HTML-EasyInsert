# 微信公众号编辑器插入 HTML 脚本

Tampermonkey 用户脚本，支持在 **微信公众平台图文编辑器（ProseMirror）** 中添加一个【插入 HTML】按钮和快捷键，通过 **模拟粘贴事件** 将 HTML 内容安全插入到光标处，保留原有格式并避免重复纯文本问题。

## ✨ 功能特点
- **一键插入 HTML**：左下角悬浮按钮【插入HTML】，点击后可在弹窗中输入/粘贴 HTML 内容。
- **快捷键调用**：`Ctrl/⌘ + Shift + H` 直接打开插入窗口。
- **支持 ProseMirror 编辑器**：使用 `ClipboardEvent + DataTransfer` 模拟真实粘贴，确保内容由编辑器自身解析，防止被覆盖或丢失格式。
- **去重防重复**：通过快照对比判断是否已成功插入，避免“带格式 + 紧跟纯文本”的重复问题。
- **实时预览**：弹窗内可预览 HTML 渲染效果。
- **跨 iframe**：自动检测主页面和 iframe 内的编辑器实例。

## 📦 安装方法
1. 安装 [Tampermonkey](https://www.tampermonkey.net/) 浏览器扩展。
2. 打开 Tampermonkey 控制面板 → 新建脚本。
3. 将脚本代码完整粘贴进去并保存。
4. 打开微信公众号后台的图文编辑页面（`https://mp.weixin.qq.com/*`），确认脚本生效。

## 🖱 使用方法
1. 在编辑区中点击一次，使光标定位到需要插入的位置。
2. 点击左下角绿色【插入HTML】按钮（或按 `Ctrl/⌘ + Shift + H`）打开输入窗口。
3. 在输入框中粘贴或输入 HTML 代码。
4. 点击【预览】查看渲染效果。
5. 点击【插入】即可将内容插入到当前光标处。

## ⚠ 注意事项
- **平台过滤**：微信公众平台会自动过滤 `<script>`、大多数 `<iframe>`、内联事件（如 `onclick`）、部分样式等不安全内容，这是平台安全策略，无法绕过。
- **样式兼容**：建议使用行内样式（`style="..."`）或内联安全标签，避免平台去掉外部样式表。
- **光标位置**：如果未先点击编辑区获取焦点，内容可能会被追加到文末。
- **ProseMirror 特性**：编辑器可能会根据 schema 调整 HTML 标签结构，这是正常现象。
- **使用请点🌟**

## 🛠 定制
- 可以将按钮位置从左下角移动到工具栏，通过修改 `mountUI()` 中的 DOM 挂载位置实现。
- 可以增加常用模板片段，直接在弹窗中一键选择插入。
- 可以加“导出 HTML”功能，方便反向获取编辑器中的内容。

## 📜 许可证
本脚本仅供学习与个人使用，不得用于违反平台规则的内容发布。
